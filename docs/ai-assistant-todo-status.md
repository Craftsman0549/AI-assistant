# AIアシスタント付きToDoアプリ 開発状況メモ（ドラフト）

この資料は、`docs/ai-assistant-todo-concept.md` の要件草案をもとにした現在の実装状況と、次に着手すべき開発タスクを整理したドラフトです。実装進捗や仕様変更に合わせて継続的に更新してください。

## 現在実装済みの主な要素
- **タスク管理UI（Next.js / `taskPanel.tsx`）**  
  - タスクの作成・編集・削除・検索・ステータス変更（未着手/進行中/完了/中止）に対応。  
  - 優先度・期限・備考入力やフィルタリング、リアルタイム更新（Supabase Realtime＋10秒ポーリング）を実装。  
  - 作業開始/停止/完了操作がUIから可能で、進行中タスクにはリマインダー通知（AITuberKitの音声出力）を送信。
- **作業時間トラッキング（`tasksService.ts` / `tasksRepo.ts`）**  
  - 作業開始時に`work_sessions`を生成し、停止/完了で終了時刻を記録。  
  - タスクごとの累計作業時間やアクティブ状態を取得できるAPI（`/api/tasks/*`）を提供。  
  - Supabase接続時はPostgreSQL、ローカルではSQLite（`data/tasks.db`）を使用。
- **振り返り・分析ビュー（`reviewModal.tsx`）**  
  - 日/週/月単位の期間集計、タスク別集計、日別推移、完了件数を表示。  
  - CSVエクスポートに対応し、AI要約ボタンから要約API（`/api/ai/vercel`）を呼び出す暫定フローを構築。
- **AIとの連携ポイント**  
  - 進捗の声掛けや操作完了時のフィードバックをAITuberKit経由で発話。  
  - Mastraベースの`mcpAgent`は検索エージェントとして準備済み（タスク操作との連携は未実装）。
- **認証まわり（Supabase Auth）**  
  - `/login`ページでメール＋パスワード/Magic Link認証のUIを提供。  
  - API呼び出し時にSupabaseセッションのBearerトークンを添付する仕組みをタスク操作に導入。

## 未実装・検討中の領域（要件とのギャップ）
- **ユーザー別タスク分離**: タスク／作業ログに`userId`等の所有者情報がなく、認証はUIのみ。マルチデバイス同期はSupabase依存だが、同一ユーザー判定が未整備。
- **定期タスク**: 繰り返しルールの保存・自動生成ロジックが未着手。
- **高度なスケジューリング**: 作業可能時間設定、AI提案スケジュール、外部カレンダー連携は未実装。
- **会話インターフェース統合**: チャット/音声からタスク作成・編集・スケジュール操作を行うフローが用意されていない。
- **他ユーザー連携**: 公開ステータス閲覧や共有範囲設定、モチベーション機能などは未着手。
- **プライバシー/セキュリティ設計**: データ共有やAIログ出力のガバナンス指針、監査ログ整備が未定義。
- **モバイル最適化＆通知**: 現状はデスクトップUI想定。モバイルでの閲覧/操作やPush通知は未対応。

## 次に着手したい開発タスク（提案）
1. **ユーザーコンテキスト実装の整備**  
   - タスク/作業ログスキーマにユーザー識別子を追加し、API層で認証ユーザーにスコープする。  
   - Supabase利用時のRow Level Securityポリシー設計、SQLite向けの簡易認証モックを検討。
2. **タスク生成フローのAI連携拡張**  
   - チャット/音声からタスク作成・状態更新を呼び出すエージェントツール定義。  
   - 生成したタスク内容の確認プロンプトやエラー時のリカバリ指針を設計。
3. **定期タスクとスケジューリング基盤の設計**  
   - 繰り返しルール（iCal RRULE相当）のモデリング、インスタンス生成タイミング、編集/スキップ仕様を決める。  
   - 作業可能時間設定UIとスケジュール生成アルゴリズムのPoC、外部カレンダーAPI調査を進める。
4. **振り返り/共有の拡張**  
   - AI要約のプロンプト精緻化・根拠表示、共有ビューにおける公開範囲・匿名化ルールの定義。  
   - チーム/他ユーザーが閲覧するダッシュボードやリアクション機能の要件固め。
5. **UX向上と運用整備**  
   - モバイル対応、通知設計、アクセシビリティ検証の計画立案。  
   - ドキュメント更新フロー（仕様変更時のレビュープロセス、テンプレート）の整備。

---

本ドキュメントは進行中の作業内容を共有するためのドラフトです。新たな実装が完了した際や優先度が変化した際には、本ファイルとコンセプトドキュメントの両方を必ず更新してください。
